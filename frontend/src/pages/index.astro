---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import { strapiGraphQL } from '../lib/strapi';

// Fetch featured projects
const response = await strapiGraphQL({
    query: `
        query {
            projects(filters: { featured: { eq: true } }, pagination: { limit: 5 }) {
                title
                slug
                start_date
                release_date
                cover { url }
                technologies { 
                    name
                    icon { url }
                }
            }
        }
    `
}).catch(() => null);

const featuredProjects = response?.projects || [];
---

<Layout title="FIKRAN | Creative Digital Portfolio">
    <Header />
    
    <main>
        <!-- Hero Section -->
        <section class="min-h-[100svh] flex items-center justify-center pt-32 pb-20 overflow-hidden relative">
            <div class="max-w-7xl mx-auto px-6 grid md:grid-cols-2 gap-16 md:gap-20 items-center">
                <div class="space-y-8 md:space-y-10 reveal text-center md:text-left">
                    <div class="inline-flex items-center gap-3 px-4 py-2 rounded-full bg-white/5 border border-white/10 text-[10px] md:text-xs font-bold uppercase tracking-widest mx-auto md:ml-0">
                        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                        Available for Projects
                    </div>
                    <h1 class="text-5xl sm:text-6xl md:text-8xl font-black leading-[0.9] tracking-tighter uppercase font-display">
                        Crafting <span class="text-indigo-500 italic">Digital</span> Excellence.
                    </h1>
                    <p class="text-lg md:text-xl text-gray-400 max-w-lg md:mx-0 mx-auto leading-relaxed font-light">
                        I build immersive digital experiences where <span class="text-white font-medium border-b border-indigo-500/30">high-end design</span> meets <span class="text-white font-medium border-b border-indigo-500/30">engineering precision.</span>
                    </p>
                    <div class="flex flex-col sm:flex-row items-center justify-center md:justify-start gap-4 md:gap-6 pt-4">
                        <a href="/projects" class="w-full sm:w-auto px-10 py-5 bg-indigo-600 hover:bg-indigo-500 text-white font-black uppercase tracking-widest text-xs rounded-2xl transition-all hover:scale-105 active:scale-95 shadow-2xl shadow-indigo-600/30 text-center">
                            Build Your Vision
                        </a>
                        <a href="/gallery" class="w-full sm:w-auto px-10 py-5 bg-white/5 hover:bg-white/10 text-white font-black uppercase tracking-widest text-xs rounded-2xl transition-all border border-white/10 text-center">
                            Exploration
                        </a>
                    </div>
                </div>

                <!-- Floating Canvas/Visual -->
                <div class="relative group hidden md:block reveal" style="transition-delay: 200ms;">
                    <div class="absolute -inset-10 bg-indigo-500/20 blur-[100px] rounded-full group-hover:bg-indigo-500/30 transition-all duration-1000"></div>
                    <div class="relative aspect-square bg-gradient-to-tr from-[#111] to-[#222] rounded-[3rem] border border-white/10 overflow-hidden rotate-3 group-hover:rotate-0 transition-all duration-700 shadow-2xl">
                        <img src="https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=1964&auto=format&fit=crop" alt="Abstract 3D Art" class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition-opacity duration-700" />
                    </div>
                    <div class="absolute -bottom-10 -left-10 p-10 bg-[#0a0a0b]/80 backdrop-blur-2xl border border-white/10 rounded-[2rem] shadow-2xl reveal" style="transition-delay: 400ms;">
                        <div class="flex items-center gap-6">
                            <div class="text-5xl font-black font-display text-indigo-500">3+</div>
                            <div class="text-xs font-bold text-gray-400 uppercase tracking-widest leading-tight">Years Of<br/>Excellence</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Featured Projects -->
        <section class="py-40 bg-[#080808]">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex flex-col md:flex-row md:items-end justify-between gap-10 mb-24 reveal">
                    <div>
                        <h2 class="text-4xl md:text-6xl font-black uppercase font-display leading-tight">Selected<br/><span class="text-indigo-500">Works</span></h2>
                    </div>
                    <p class="text-gray-400 max-w-sm font-medium">A curated selection of projects where design meets function.</p>
                </div>

                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-10">
                    {featuredProjects.map((project: any, index: number) => (
                        <a 
                            href={`/projects/${project.slug}`} 
                            class={`group reveal ${index === 0 ? 'lg:col-span-2' : ''}`} 
                            style={`transition-delay: ${index * 100}ms;`}
                        >
                            <article class="relative space-y-6">
                                <div class={`overflow-hidden rounded-[2.5rem] bg-neutral-900 border border-white/5 relative ${index === 0 ? 'aspect-[16/9] md:aspect-[21/9]' : 'aspect-[4/5]'}`}>
                                    {project.cover?.url ? (
                                        <img 
                                            src={`http://localhost:1337${project.cover.url}`} 
                                            alt={project.title}
                                            class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
                                        />
                                    ) : (
                                        <div class="w-full h-full bg-gradient-to-br from-indigo-900/40 to-black"></div>
                                    )}
                                    <div class="absolute inset-x-0 bottom-0 p-8 translate-y-full group-hover:translate-y-0 transition-transform duration-500 bg-gradient-to-t from-black via-black/80 to-transparent">
                                        <div class="flex flex-wrap gap-2">
                                            {project.technologies?.map((tech: any) => (
                                                <span class="px-2.5 py-1 bg-white/10 backdrop-blur-md rounded-lg text-[9px] font-bold text-white uppercase flex items-center gap-1.5 border border-white/5">
                                                    {tech.icon?.url && (
                                                        <img src={`http://localhost:1337${tech.icon.url}`} alt={tech.name} class="w-3.5 h-3.5 object-contain brightness-0 invert" />
                                                    )}
                                                    {tech.name}
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                <div class={index === 0 ? 'flex flex-col md:flex-row md:items-end justify-between gap-4' : ''}>
                                    <div>
                                        <h3 class={`${index === 0 ? 'text-3xl md:text-5xl' : 'text-2xl'} font-black uppercase font-display group-hover:text-indigo-400 transition-colors`}>{project.title}</h3>
                                        <p class="text-gray-500 text-sm font-bold uppercase tracking-widest mt-2">
                                            {project.release_date ? new Date(project.release_date).getFullYear() : (project.start_date ? new Date(project.start_date).getFullYear() : 'Ongoing')}
                                        </p>
                                    </div>
                                    {index === 0 && (
                                        <span class="text-xs font-bold uppercase tracking-widest text-indigo-500 border-b border-indigo-500/20 pb-1 shrink-0">Featured Project</span>
                                    )}
                                </div>
                            </article>
                        </a>
                    ))}
                    
                    <!-- Fallback if empty -->
                    {featuredProjects.length === 0 && (
                        <div class="col-span-full py-20 text-center border-2 border-dashed border-white/5 rounded-[3rem]">
                            <p class="text-gray-500 font-bold uppercase tracking-widest italic">Start creating projects in Strapi to showcase your work.</p>
                        </div>
                    )}
                </div>

                <div class="mt-24 text-center reveal">
                    <a href="/projects" class="inline-flex items-center gap-4 text-xs font-black uppercase tracking-[0.2em] group">
                        <span class="w-12 h-[1px] bg-white/20 group-hover:w-20 group-hover:bg-indigo-500 transition-all duration-500"></span>
                        View All Projects
                        <span class="w-12 h-[1px] bg-white/20 group-hover:w-20 group-hover:bg-indigo-500 transition-all duration-500"></span>
                    </a>
                </div>
            </div>
        </section>
    </main>
</Layout>

<script>
    // Intersection Observer for Reveal Animations
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('active');
            }
        });
    }, { threshold: 0.1 });

    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
</script>

<style is:global>
    .reveal {
        opacity: 0;
        transform: translateY(30px);
        transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    }
    .reveal.active {
        opacity: 1;
        transform: translateY(0);
    }
</style>
